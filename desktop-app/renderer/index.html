<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sandra IA 8.0 Pro - Multimodal</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #fff;
      overflow: hidden;
      height: 100vh;
    }

    .app-container {
      display: grid;
      grid-template-columns: 280px 1fr 350px;
      grid-template-rows: 60px calc(100vh - 140px) 80px;
      height: 100vh;
      gap: 0;
      overflow: hidden;
    }

    /* HEADER */
    .header {
      grid-column: 1 / -1;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 0 30px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      z-index: 100;
    }

    .header h1 {
      font-size: 24px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #10b981;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .header-controls {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .ai-provider {
      padding: 8px 16px;
      background: rgba(255,255,255,0.2);
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
    }

    /* SIDEBAR */
    .sidebar {
      background: #16213e;
      padding: 20px;
      overflow-y: auto;
      border-right: 1px solid rgba(255,255,255,0.1);
    }

    .sidebar::-webkit-scrollbar { width: 6px; }
    .sidebar::-webkit-scrollbar-track { background: transparent; }
    .sidebar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }

    .sidebar h3 {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #8b92a8;
      margin: 20px 0 10px 0;
    }

    .sidebar h3:first-child { margin-top: 0; }

    .role-btn {
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 8px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: #fff;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .role-btn:hover {
      background: rgba(102, 126, 234, 0.3);
      border-color: #667eea;
      transform: translateX(5px);
    }

    .role-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: #667eea;
    }

    /* CHAT AREA */
    .chat-area {
      display: flex;
      flex-direction: column;
      background: #0f3460;
      position: relative;
      overflow: hidden;
    }

    .messages-container {
      flex: 1;
      overflow-y: auto;
      padding: 30px;
      scroll-behavior: smooth;
    }

    .messages-container::-webkit-scrollbar { width: 8px; }
    .messages-container::-webkit-scrollbar-track { background: transparent; }
    .messages-container::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 4px; }

    .message {
      margin-bottom: 20px;
      display: flex;
      gap: 15px;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .message.user {
      flex-direction: row-reverse;
    }

    .message-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      flex-shrink: 0;
    }

    .message.user .message-avatar {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .message-content {
      max-width: 70%;
      padding: 15px 20px;
      border-radius: 18px;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      line-height: 1.6;
    }

    .message.user .message-content {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .message-time {
      font-size: 11px;
      color: rgba(255,255,255,0.5);
      margin-top: 5px;
    }

    /* AVATAR PANEL */
    .avatar-panel {
      background: #16213e;
      padding: 20px;
      border-left: 1px solid rgba(255,255,255,0.1);
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .avatar-container {
      width: 100%;
      aspect-ratio: 1;
      background: #0f3460;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
      border: 2px solid rgba(102, 126, 234, 0.3);
    }

    #heygen-avatar {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .avatar-status {
      padding: 12px;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      font-size: 12px;
    }

    .avatar-status-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .avatar-status-item:last-child { margin-bottom: 0; }

    .status-label {
      color: rgba(255,255,255,0.6);
    }

    .status-value {
      font-weight: 600;
      color: #10b981;
    }

    /* MULTIMODAL INPUT BAR */
    .input-bar {
      grid-column: 1 / -1;
      grid-row: 3;
      background: #16213e;
      border-top: 1px solid rgba(255,255,255,0.1);
      padding: 15px 30px;
      display: flex !important;
      gap: 15px;
      align-items: center;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
      position: relative;
      z-index: 100;
      min-height: 80px;
      height: 80px;
      max-height: 80px;
    }

    .input-wrapper {
      flex: 1;
      position: relative;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    #message-input {
      flex: 1;
      padding: 15px 20px;
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 25px;
      color: #fff;
      font-size: 15px;
      outline: none;
      transition: all 0.3s;
    }

    #message-input:focus {
      border-color: #667eea;
      background: rgba(255,255,255,0.08);
    }

    .input-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      transition: all 0.3s;
      flex-shrink: 0;
    }

    .btn-voice {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
    }

    .btn-voice:hover {
      transform: scale(1.1);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.5);
    }

    .btn-voice.recording {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      animation: recordPulse 1.5s infinite;
    }

    @keyframes recordPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .btn-send {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #fff;
    }

    .btn-send:hover {
      transform: scale(1.1);
      box-shadow: 0 5px 20px rgba(16, 185, 129, 0.5);
    }

    .btn-send:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: scale(1);
    }

    /* RECORDING INDICATOR */
    .recording-indicator {
      position: absolute;
      top: -50px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      padding: 12px 24px;
      border-radius: 25px;
      display: none;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      box-shadow: 0 5px 20px rgba(239, 68, 68, 0.5);
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from { transform: translateX(-50%) translateY(-10px); opacity: 0; }
      to { transform: translateX(-50%) translateY(0); opacity: 1; }
    }

    .recording-indicator.active {
      display: flex;
    }

    .recording-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #fff;
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* LOADING */
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
      color: rgba(255,255,255,0.6);
    }

    .loading.active {
      display: block;
    }

    .spinner {
      display: inline-block;
      width: 30px;
      height: 30px;
      border: 3px solid rgba(255,255,255,0.1);
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* TOAST NOTIFICATIONS */
    .toast {
      position: fixed;
      top: 80px;
      right: 30px;
      background: rgba(16, 185, 129, 0.95);
      color: #fff;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
      display: none;
      align-items: center;
      gap: 10px;
      z-index: 1000;
      animation: slideInRight 0.3s ease-out;
    }

    @keyframes slideInRight {
      from { transform: translateX(400px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .toast.active {
      display: flex;
    }

    .toast.error {
      background: rgba(239, 68, 68, 0.95);
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- HEADER -->
    <div class="header">
      <h1>
        <span class="status-indicator"></span>
        üöÄ Sandra IA 8.0 Pro
      </h1>
      <div class="header-controls">
        <div class="ai-provider" id="ai-provider">Groq (Mixtral)</div>
      </div>
    </div>

    <!-- SIDEBAR -->
    <div class="sidebar">
      <h3>üéØ Roles Especializados (18)</h3>
      <button class="role-btn active" data-role="general">
        üí¨ General
      </button>
      <button class="role-btn" data-role="administrator">
        üëî Administrador
      </button>
      <button class="role-btn" data-role="developer">
        üíª Desarrollador
      </button>
      <button class="role-btn" data-role="youtuber">
        üé¨ YouTuber
      </button>
      <button class="role-btn" data-role="community">
        üë• Community Manager
      </button>
      <button class="role-btn" data-role="tourism">
        üè® Turismo
      </button>
      <button class="role-btn" data-role="sales">
        üíº Ventas
      </button>
      <button class="role-btn" data-role="analyst">
        üìä Analista
      </button>
      <button class="role-btn" data-role="marketing">
        üìà Marketing
      </button>
      <button class="role-btn" data-role="ceo">
        üè¢ CEO/Ejecutivo
      </button>
      <button class="role-btn" data-role="designer">
        üé® Dise√±ador
      </button>
      <button class="role-btn" data-role="lawyer">
        ‚öñÔ∏è Abogado
      </button>
      <button class="role-btn" data-role="doctor">
        ü•º M√©dico
      </button>
      <button class="role-btn" data-role="teacher">
        üìö Profesor
      </button>
      <button class="role-btn" data-role="financial">
        üí∞ Asesor Financiero
      </button>
      <button class="role-btn" data-role="artist">
        üé≠ Artista
      </button>
      <button class="role-btn" data-role="scientist">
        üî¨ Cient√≠fico
      </button>
      <button class="role-btn" data-role="engineer">
        üîß Ingeniero
      </button>
      <button class="role-btn" data-role="psychologist">
        üß† Psic√≥logo
      </button>

      <h3>‚öôÔ∏è Sistema</h3>
      <button class="role-btn" data-action="mcp">
        üõ†Ô∏è Panel MCP
      </button>
      <button class="role-btn" data-action="validate">
        ‚úÖ Validar Roles
      </button>
      <button class="role-btn" data-action="stats">
        üìä Estad√≠sticas
      </button>
      <button class="role-btn" data-action="clear">
        üßπ Limpiar Chat
      </button>
    </div>

    <!-- CHAT AREA -->
    <div class="chat-area">
      <div class="messages-container" id="messages">
        <div class="message">
          <div class="message-avatar">S</div>
          <div class="message-content">
            <div>¬°Hola! Soy Sandra IA 8.0 Pro. Puedo ayudarte con 18 roles especializados. ¬øEn qu√© puedo asistirte hoy?</div>
            <div class="message-time" id="init-time"></div>
          </div>
        </div>
      </div>
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>Sandra est√° pensando...</div>
      </div>
    </div>

    <!-- AVATAR PANEL -->
    <div class="avatar-panel">
      <div class="avatar-container">
        <video id="heygen-avatar-video" autoplay playsinline style="width: 100%; height: 100%; object-fit: cover; display: none;"></video>
        <div id="heygen-avatar"></div>
      </div>
      
      <!-- Selector de Voz -->
      <div style="padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 10px;">
        <label style="font-size: 11px; color: rgba(255,255,255,0.6); display: block; margin-bottom: 5px;">üéôÔ∏è Voz del Avatar:</label>
        <select id="voice-selector" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; color: #fff; font-size: 12px;">
          <option value="default">Sandra (Espa√±ol)</option>
          <option value="voice-2">Mar√≠a (Formal)</option>
          <option value="voice-3">Carmen (Amigable)</option>
          <option value="voice-4">Laura (Profesional)</option>
        </select>
      </div>

      <!-- Modo Conversaci√≥n -->
      <div style="padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 10px;">
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
          <input type="checkbox" id="continuous-mode" style="width: 16px; height: 16px;">
          <span style="font-size: 12px; color: #fff;">üîÑ Modo Continuo</span>
        </label>
        <div style="font-size: 10px; color: rgba(255,255,255,0.5); margin-top: 5px; margin-left: 24px;">
          Conversaci√≥n sin clicks
        </div>
      </div>

      <!-- Barge-in -->
      <div style="padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 10px;">
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
          <input type="checkbox" id="barge-in-toggle" checked style="width: 16px; height: 16px;">
          <span style="font-size: 12px; color: #fff;">‚ö° Barge-in</span>
        </label>
        <div style="font-size: 10px; color: rgba(255,255,255,0.5); margin-top: 5px; margin-left: 24px;">
          Interrumpir respuestas
        </div>
      </div>

      <div class="avatar-status">
        <div class="avatar-status-item">
          <span class="status-label">Estado:</span>
          <span class="status-value" id="avatar-status">Conectado</span>
        </div>
        <div class="avatar-status-item">
          <span class="status-label">Rol Activo:</span>
          <span class="status-value" id="active-role">General</span>
        </div>
        <div class="avatar-status-item">
          <span class="status-label">Modo:</span>
          <span class="status-value" id="mode-status">Multimodal</span>
        </div>
      </div>
    </div>

    <!-- MULTIMODAL INPUT BAR -->
    <div class="input-bar">
      <div class="recording-indicator" id="recording-indicator">
        <div class="recording-dot"></div>
        <span>Grabando... (Click para detener)</span>
      </div>
      
      <!-- Audio Visualizer Canvas -->
      <canvas id="audio-visualizer" style="position: absolute; top: -60px; left: 50%; transform: translateX(-50%); width: 400px; height: 50px; border-radius: 8px; background: rgba(0,0,0,0.3); display: none;"></canvas>
      
      <div class="input-wrapper">
        <input 
          type="text" 
          id="message-input" 
          placeholder="Escribe tu mensaje o usa el micr√≥fono..."
          autocomplete="off"
        />
        <button class="input-btn btn-voice" id="voice-btn" title="Grabar voz">
          üé§
        </button>
        <button class="input-btn btn-send" id="send-btn" title="Enviar mensaje">
          ‚û§
        </button>
      </div>
    </div>
  </div>

  <!-- TOAST NOTIFICATION -->
  <div class="toast" id="toast">
    <span id="toast-message"></span>
  </div>

  <!-- MCP PANEL (MODULAR CONTROL PANEL) -->
  <div id="mcp-panel" style="display: none; position: fixed; top: 80px; left: 50%; transform: translateX(-50%); width: 900px; max-height: 80vh; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border: 2px solid #667eea; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); z-index: 1000; overflow: hidden;">
    <!-- MCP Header -->
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;">
      <h2 style="font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 10px;">
        üõ†Ô∏è MCP - Modular Control Panel
      </h2>
      <button id="mcp-close" style="background: rgba(255,255,255,0.2); border: none; color: #fff; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center;">√ó</button>
    </div>
    
    <!-- MCP Content -->
    <div style="padding: 20px; overflow-y: auto; max-height: calc(80vh - 60px);">
      <!-- Tabs -->
      <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">
        <button class="mcp-tab active" data-tab="code" style="padding: 8px 16px; background: rgba(102, 126, 234, 0.3); border: 1px solid #667eea; border-radius: 6px; color: #fff; cursor: pointer; font-size: 13px; font-weight: 600;">üíª Generar C√≥digo</button>
        <button class="mcp-tab" data-tab="deploy" style="padding: 8px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #fff; cursor: pointer; font-size: 13px; font-weight: 600;">üöÄ Deploy</button>
        <button class="mcp-tab" data-tab="agents" style="padding: 8px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #fff; cursor: pointer; font-size: 13px; font-weight: 600;">ü§ñ Agentes</button>
        <button class="mcp-tab" data-tab="github" style="padding: 8px 16px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #fff; cursor: pointer; font-size: 13px; font-weight: 600;">üì¶ GitHub</button>
      </div>
      
      <!-- Tab: Generar C√≥digo -->
      <div id="mcp-tab-code" class="mcp-tab-content">
        <h3 style="font-size: 14px; color: rgba(255,255,255,0.8); margin-bottom: 15px;">Generaci√≥n de C√≥digo con IA</h3>
        
        <label style="display: block; font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 5px;">Tarea:</label>
        <textarea id="mcp-code-task" placeholder="Ej: Crear una funci√≥n para validar emails..." style="width: 100%; height: 100px; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #fff; font-size: 13px; resize: vertical; margin-bottom: 15px;"></textarea>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
          <div>
            <label style="display: block; font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 5px;">Rol:</label>
            <select id="mcp-code-role" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #fff; font-size: 13px;">
              <option value="developer">üíª Desarrollador</option>
              <option value="engineer">üîß Ingeniero</option>
              <option value="scientist">üî¨ Cient√≠fico</option>
            </select>
          </div>
          <div>
            <label style="display: block; font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 5px;">Lenguaje:</label>
            <select id="mcp-code-lang" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #fff; font-size: 13px;">
              <option value="javascript">JavaScript</option>
              <option value="python">Python</option>
              <option value="typescript">TypeScript</option>
              <option value="java">Java</option>
              <option value="csharp">C#</option>
            </select>
          </div>
        </div>
        
        <button id="mcp-generate-code" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none; border-radius: 6px; color: #fff; font-size: 14px; font-weight: 600; cursor: pointer; margin-bottom: 15px;">‚ú® Generar C√≥digo</button>
        
        <div id="mcp-code-output" style="display: none;">
          <label style="display: block; font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 5px;">C√≥digo Generado:</label>
          <pre style="background: #0f3460; padding: 15px; border-radius: 6px; overflow-x: auto; font-size: 12px; color: #10b981; max-height: 300px; overflow-y: auto;"><code id="mcp-code-result"></code></pre>
        </div>
      </div>
      
      <!-- Tab: Deploy -->
      <div id="mcp-tab-deploy" class="mcp-tab-content" style="display: none;">
        <h3 style="font-size: 14px; color: rgba(255,255,255,0.8); margin-bottom: 15px;">Despliegue Autom√°tico</h3>
        
        <label style="display: block; font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 5px;">Nombre del Proyecto:</label>
        <input id="mcp-deploy-name" type="text" placeholder="mi-proyecto" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #fff; font-size: 13px; margin-bottom: 15px;">
        
        <label style="display: block; font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 5px;">URL del Repositorio:</label>
        <input id="mcp-deploy-repo" type="text" placeholder="https://github.com/user/repo.git" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #fff; font-size: 13px; margin-bottom: 15px;">
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
          <div>
            <label style="display: block; font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 5px;">Proveedor:</label>
            <select id="mcp-deploy-provider" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #fff; font-size: 13px;">
              <option value="vercel">Vercel</option>
              <option value="netlify">Netlify</option>
            </select>
          </div>
          <div>
            <label style="display: block; font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 5px;">Entorno:</label>
            <select id="mcp-deploy-env" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #fff; font-size: 13px;">
              <option value="production">Production</option>
              <option value="staging">Staging</option>
            </select>
          </div>
        </div>
        
        <button id="mcp-deploy-btn" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 6px; color: #fff; font-size: 14px; font-weight: 600; cursor: pointer;">üöÄ Desplegar Ahora</button>
        
        <div id="mcp-deploy-output" style="display: none; margin-top: 15px; padding: 15px; background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; border-radius: 6px; font-size: 12px; color: #10b981;"></div>
      </div>
      
      <!-- Tab: Agentes -->
      <div id="mcp-tab-agents" class="mcp-tab-content" style="display: none;">
        <h3 style="font-size: 14px; color: rgba(255,255,255,0.8); margin-bottom: 15px;">Gesti√≥n de Agentes</h3>
        
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
          <select id="mcp-agent-role" style="flex: 1; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #fff; font-size: 13px;">
            <option value="developer">üíª Desarrollador</option>
            <option value="youtuber">üé¨ YouTuber</option>
            <option value="community">üë• Community Manager</option>
            <option value="tourism">üè® Turismo</option>
            <option value="sales">üíº Ventas</option>
          </select>
          <button id="mcp-spawn-agent" style="padding: 10px 20px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none; border-radius: 6px; color: #fff; font-size: 13px; font-weight: 600; cursor: pointer;">ü§ñ Crear Agente</button>
        </div>
        
        <div id="mcp-agents-list" style="background: rgba(255,255,255,0.05); border-radius: 6px; padding: 15px; min-height: 200px;">
          <div style="text-align: center; color: rgba(255,255,255,0.4); padding: 40px 0;">
            No hay agentes activos
          </div>
        </div>
      </div>
      
      <!-- Tab: GitHub -->
      <div id="mcp-tab-github" class="mcp-tab-content" style="display: none;">
        <h3 style="font-size: 14px; color: rgba(255,255,255,0.8); margin-bottom: 15px;">Sincronizaci√≥n con GitHub</h3>
        
        <button id="mcp-github-sync" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 6px; color: #fff; font-size: 14px; font-weight: 600; cursor: pointer; margin-bottom: 15px;">üîÑ Sincronizar Ahora</button>
        
        <div id="mcp-github-status" style="background: rgba(255,255,255,0.05); border-radius: 6px; padding: 15px;">
          <div style="text-align: center; color: rgba(255,255,255,0.4);">
            Click en sincronizar para obtener el estado del repositorio
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==================== VARIABLES GLOBALES ====================
    let currentRole = 'general';
    let isRecording = false;
    let mediaRecorder = null;
    let audioChunks = [];
    let servicesReady = false;
    let audioVisualizer = null;
    let currentVoiceId = 'default';
    let continuousMode = false;
    let bargeInEnabled = true;
    let webrtcManager = null;

    // ==================== ELEMENTOS DOM ====================
    const messagesContainer = document.getElementById('messages');
    const messageInput = document.getElementById('message-input');
    const sendBtn = document.getElementById('send-btn');
    const voiceBtn = document.getElementById('voice-btn');
    const recordingIndicator = document.getElementById('recording-indicator');
    const loading = document.getElementById('loading');
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toast-message');
    const activeRoleDisplay = document.getElementById('active-role');
    const avatarStatus = document.getElementById('avatar-status');

    // ==================== INICIALIZACI√ìN ====================
    document.getElementById('init-time').textContent = new Date().toLocaleTimeString('es-ES');

    // Escuchar eventos del sistema
    if (window.sandraAPI) {
      window.sandraAPI.onServicesReady((data) => {
        servicesReady = true;
        showToast('‚úÖ Todos los servicios iniciados correctamente');
        avatarStatus.textContent = 'Operativo';
      });

      window.sandraAPI.onServicesError((data) => {
        showToast('‚ùå Error: ' + data.error, 'error');
        avatarStatus.textContent = 'Error';
      });
    }

    // ==================== ROLES ====================
    document.querySelectorAll('.role-btn[data-role]').forEach(btn => {
      btn.addEventListener('click', () => {
        // Actualizar UI
        document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Actualizar rol actual
        currentRole = btn.dataset.role;
        activeRoleDisplay.textContent = btn.textContent.trim();
        
        showToast(`Rol cambiado a: ${btn.textContent.trim()}`);
      });
    });

    // ==================== ACCIONES ====================
    document.querySelectorAll('.role-btn[data-action]').forEach(btn => {
      btn.addEventListener('click', async () => {
        const action = btn.dataset.action;
        
        if (action === 'clear') {
          messagesContainer.innerHTML = '';
          showToast('Chat limpiado');
        } else if (action === 'stats') {
          if (window.sandraAPI) {
            const result = await window.sandraAPI.getStats();
            if (result.success) {
              const stats = result.stats;
              addMessage(`üìä Estad√≠sticas del Sistema:\n\n- Roles Activos: ${stats.activeRoles}/${stats.totalRoles}\n- Agentes Activos: ${stats.activeAgents}\n- Conversaciones: ${stats.conversations || 0}\n- Deployments: ${stats.deployments || 0}`, 'assistant');
            }
          }
        } else if (action === 'validate') {
          showToast('Validando roles...');
          setTimeout(() => showToast('‚úÖ Todos los roles validados'), 2000);
        } else if (action === 'mcp') {
          // Abrir panel MCP
          document.getElementById('mcp-panel').style.display = 'block';
        }
      });
    });

    // ==================== ENVIAR MENSAJE ====================
    async function sendMessage() {
      const message = messageInput.value.trim();
      if (!message) return;

      // Limpiar input
      messageInput.value = '';

      // Agregar mensaje del usuario
      addMessage(message, 'user');

      // Mostrar loading
      loading.classList.add('active');

      try {
        if (window.sandraAPI) {
          const result = await window.sandraAPI.sendMessage(message, currentRole);
          
          if (result.success) {
            addMessage(result.response, 'assistant');
          } else {
            addMessage('Error: ' + result.error, 'assistant');
          }
        } else {
          // Modo offline/demo
          setTimeout(() => {
            const responses = [
              'Entendido, estoy procesando tu solicitud...',
              'Excelente pregunta. D√©jame analizar eso...',
              'Perfecto, trabajando en ello...',
              'Interesante planteamiento. Te ayudar√© con eso...'
            ];
            addMessage(responses[Math.floor(Math.random() * responses.length)], 'assistant');
          }, 1000);
        }
      } catch (error) {
        console.error('Error al enviar mensaje:', error);
        addMessage('Error al procesar el mensaje', 'assistant');
      } finally {
        loading.classList.remove('active');
      }
    }

    // ==================== GRABACI√ìN DE VOZ CON DEEPGRAM ====================
    async function toggleVoiceRecording() {
      if (!isRecording) {
        // INICIAR GRABACI√ìN
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ 
            audio: {
              echoCancellation: true,
              noiseSuppression: true,
              sampleRate: 44100
            } 
          });
          
          mediaRecorder = new MediaRecorder(stream, {
            mimeType: 'audio/webm'
          });
          audioChunks = [];

          mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0) {
              audioChunks.push(event.data);
            }
          };

          mediaRecorder.onstop = async () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
            await processVoiceInput(audioBlob);
            
            // Detener el stream
            stream.getTracks().forEach(track => track.stop());
          };

          mediaRecorder.start(100); // Capturar cada 100ms
          isRecording = true;
          
          // Iniciar visualizador de audio
          const visualizerCanvas = document.getElementById('audio-visualizer');
          if (visualizerCanvas) {
            visualizerCanvas.style.display = 'block';
            
            // Crear visualizador
            if (!audioVisualizer) {
              // Cargar AudioVisualizer desde archivo
              const AudioVisualizer = function(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.canvasContext = this.canvas ? this.canvas.getContext('2d') : null;
                this.audioContext = null;
                this.analyser = null;
                this.dataArray = null;
                this.bufferLength = 0;
                this.animationId = null;
                this.isVisualizing = false;
                
                this.startVisualization = async function(stream) {
                  try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.analyser = this.audioContext.createAnalyser();
                    this.analyser.fftSize = 2048;
                    this.bufferLength = this.analyser.frequencyBinCount;
                    this.dataArray = new Uint8Array(this.bufferLength);
                    const source = this.audioContext.createMediaStreamSource(stream);
                    source.connect(this.analyser);
                    this.isVisualizing = true;
                    this.draw();
                    return { success: true };
                  } catch (error) {
                    return { success: false, error: error.message };
                  }
                };
                
                this.draw = function() {
                  if (!this.isVisualizing) return;
                  this.animationId = requestAnimationFrame(() => this.draw());
                  if (!this.analyser || !this.dataArray) return;
                  this.analyser.getByteTimeDomainData(this.dataArray);
                  const ctx = this.canvasContext;
                  const width = this.canvas.width;
                  const height = this.canvas.height;
                  ctx.fillStyle = 'rgba(15, 52, 96, 0.3)';
                  ctx.fillRect(0, 0, width, height);
                  ctx.lineWidth = 2;
                  ctx.strokeStyle = '#667eea';
                  ctx.beginPath();
                  const sliceWidth = width / this.bufferLength;
                  let x = 0;
                  for (let i = 0; i < this.bufferLength; i++) {
                    const v = this.dataArray[i] / 128.0;
                    const y = (v * height) / 2;
                    if (i === 0) { ctx.moveTo(x, y); } else { ctx.lineTo(x, y); }
                    x += sliceWidth;
                  }
                  ctx.lineTo(width, height / 2);
                  ctx.stroke();
                };
                
                this.stop = function() {
                  this.isVisualizing = false;
                  if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                    this.animationId = null;
                  }
                  if (this.audioContext) {
                    this.audioContext.close();
                    this.audioContext = null;
                  }
                  if (this.canvas && this.canvasContext) {
                    this.canvasContext.clearRect(0, 0, this.canvas.width, this.canvas.height);
                  }
                };
              };
              
              audioVisualizer = new AudioVisualizer('audio-visualizer');
            }
            
            audioVisualizer.startVisualization(stream);
          }
          
          // Actualizar UI
          voiceBtn.classList.add('recording');
          voiceBtn.textContent = '‚èπÔ∏è';
          recordingIndicator.classList.add('active');
          
          showToast('üé§ Grabando... Click para detener');
        } catch (error) {
          console.error('Error al acceder al micr√≥fono:', error);
          showToast('‚ùå No se pudo acceder al micr√≥fono', 'error');
        }
      } else {
        // DETENER GRABACI√ìN
        if (mediaRecorder && mediaRecorder.state !== 'inactive') {
          mediaRecorder.stop();
        }
        
        // Detener visualizador
        if (audioVisualizer) {
          audioVisualizer.stop();
          const visualizerCanvas = document.getElementById('audio-visualizer');
          if (visualizerCanvas) {
            visualizerCanvas.style.display = 'none';
          }
        }
        
        isRecording = false;
        
        // Restaurar UI
        voiceBtn.classList.remove('recording');
        voiceBtn.textContent = 'üé§';
        recordingIndicator.classList.remove('active');
        
        showToast('Procesando audio con Deepgram...');
      }
    }

    async function processVoiceInput(audioBlob) {
      try {
        if (!window.sandraAPI) {
          showToast('‚ùå API no disponible', 'error');
          return;
        }

        showToast('üé§ Transcribiendo con Deepgram STT...');
        
        // Convertir blob a buffer
        const arrayBuffer = await audioBlob.arrayBuffer();
        const buffer = new Uint8Array(arrayBuffer);
        
        // Transcribir con Deepgram
        const result = await window.sandraAPI.transcribeBuffer(buffer, 'audio/webm');
        
        if (result.success) {
          messageInput.value = result.transcript;
          showToast(`‚úÖ Transcrito (${Math.round(result.confidence * 100)}% confianza)`);
          
          // Auto-enviar si hay texto
          if (result.transcript && result.transcript.trim().length > 0) {
            setTimeout(() => sendMessage(), 500);
          }
        } else {
          showToast('‚ùå Error en transcripci√≥n: ' + result.error, 'error');
        }
      } catch (error) {
        console.error('Error al procesar audio:', error);
        showToast('‚ùå Error al procesar el audio', 'error');
      }
    }

    // ==================== AGREGAR MENSAJE ====================
    function addMessage(text, sender) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}`;
      
      const avatar = document.createElement('div');
      avatar.className = 'message-avatar';
      avatar.textContent = sender === 'user' ? 'U' : 'S';
      
      const content = document.createElement('div');
      content.className = 'message-content';
      
      const textDiv = document.createElement('div');
      textDiv.textContent = text;
      
      const time = document.createElement('div');
      time.className = 'message-time';
      time.textContent = new Date().toLocaleTimeString('es-ES');
      
      content.appendChild(textDiv);
      content.appendChild(time);
      
      messageDiv.appendChild(avatar);
      messageDiv.appendChild(content);
      
      messagesContainer.appendChild(messageDiv);
      
      // SCROLL AUTOM√ÅTICO
      setTimeout(() => {
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }, 100);
    }

    // ==================== TOAST ====================
    function showToast(message, type = 'success') {
      toastMessage.textContent = message;
      toast.className = `toast active ${type}`;
      
      setTimeout(() => {
        toast.classList.remove('active');
      }, 3000);
    }

    // ==================== EVENT LISTENERS ====================
    sendBtn.addEventListener('click', sendMessage);
    voiceBtn.addEventListener('click', toggleVoiceRecording);
    
    messageInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // Prevenir que el input pierda foco al grabar
    voiceBtn.addEventListener('mousedown', (e) => {
      e.preventDefault();
    });

    // Selector de voz
    const voiceSelector = document.getElementById('voice-selector');
    if (voiceSelector) {
      voiceSelector.addEventListener('change', (e) => {
        currentVoiceId = e.target.value;
        showToast(`Voz cambiada a: ${e.target.options[e.target.selectedIndex].text}`);
      });
    }

    // Modo continuo
    const continuousModeToggle = document.getElementById('continuous-mode');
    if (continuousModeToggle) {
      continuousModeToggle.addEventListener('change', async (e) => {
        continuousMode = e.target.checked;
        
        if (continuousMode) {
          showToast('üîÑ Modo continuo activado');
          if (window.sandraAPI) {
            await window.sandraAPI.startMultimodalConversation();
          }
        } else {
          showToast('Modo continuo desactivado');
          if (window.sandraAPI) {
            await window.sandraAPI.stopMultimodalConversation();
          }
        }
      });
    }

    // Barge-in toggle
    const bargeInToggle = document.getElementById('barge-in-toggle');
    if (bargeInToggle) {
      bargeInToggle.addEventListener('change', async (e) => {
        bargeInEnabled = e.target.checked;
        
        if (window.sandraAPI) {
          await window.sandraAPI.setBargeIn(bargeInEnabled);
        }
        
        showToast(`‚ö° Barge-in ${bargeInEnabled ? 'activado' : 'desactivado'}`);
      });
    }

    // ==================== HEYGEN AVATAR ====================
    async function initializeHeyGenAvatar() {
      const avatarContainer = document.getElementById('heygen-avatar');
      
      try {
        if (window.sandraAPI) {
          // Crear sesi√≥n de avatar
          const result = await window.sandraAPI.createAvatarSession();
          
          if (result.success) {
            // Aqu√≠ se integrar√≠a el WebRTC stream del avatar
            avatarContainer.innerHTML = `
              <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div style="font-size: 60px;">ü§ñ</div>
                <div style="font-size: 14px; color: white; font-weight: 600;">Avatar Sandra</div>
                <div style="font-size: 11px; color: rgba(255,255,255,0.8);">‚úÖ Sesi√≥n Activa</div>
                <div style="font-size: 10px; color: rgba(255,255,255,0.6);">ID: ${result.session.sessionId.substring(0, 8)}...</div>
              </div>
            `;
            
            showToast('‚úÖ Avatar HeyGen inicializado');
            avatarStatus.textContent = 'Streaming';
          } else {
            throw new Error(result.error);
          }
        }
      } catch (error) {
        console.error('Error inicializando avatar:', error);
        avatarContainer.innerHTML = `
          <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 15px;">
            <div style="font-size: 60px;">ü§ñ</div>
            <div style="font-size: 14px; color: rgba(255,255,255,0.6);">Avatar Sandra</div>
            <div style="font-size: 12px; color: rgba(255,255,255,0.4);">Modo Offline</div>
          </div>
        `;
      }
    }

    // ==================== EVENTOS MULTIMODALES ====================
    if (window.sandraAPI) {
      // Actualizaci√≥n de transcripci√≥n en tiempo real
      window.sandraAPI.onTranscriptUpdate((data) => {
        if (data.isFinal) {
          console.log('Transcripci√≥n final:', data.transcript);
        } else {
          console.log('Transcripci√≥n intermedia:', data.transcript);
        }
      });

      // Respuesta de IA lista
      window.sandraAPI.onResponseReady((data) => {
        console.log('Respuesta IA:', data.aiResponse);
        addMessage(data.aiResponse, 'assistant');
      });

      // Avatar hablando
      window.sandraAPI.onAvatarSpeaking((data) => {
        if (data.speaking) {
          avatarStatus.textContent = 'Hablando...';
          console.log('Avatar hablando:', data.text);
        } else {
          avatarStatus.textContent = 'Escuchando';
        }
      });

      // Error multimodal
      window.sandraAPI.onMultimodalError((data) => {
        console.error('Error multimodal:', data.error);
        showToast('‚ùå ' + data.error, 'error');
      });
    }

    // Inicializar avatar
    initializeHeyGenAvatar();

    console.log('‚úÖ Sandra IA 8.0 Pro - Sistema Multimodal Completo Cargado');
    console.log('üé§ Deepgram STT - Listo');
    console.log('üîä Cartesia TTS - Listo');
    console.log('ü§ñ HeyGen Avatar - Listo');
    console.log('üîÑ Barge-in - Activado');

    // ==================== MCP PANEL ====================
    
    // Cerrar panel MCP
    document.getElementById('mcp-close').addEventListener('click', () => {
      document.getElementById('mcp-panel').style.display = 'none';
    });

    // Tabs del MCP
    document.querySelectorAll('.mcp-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.dataset.tab;
        
        // Actualizar tabs activos
        document.querySelectorAll('.mcp-tab').forEach(t => {
          t.style.background = 'rgba(255,255,255,0.05)';
          t.style.borderColor = 'rgba(255,255,255,0.1)';
        });
        tab.style.background = 'rgba(102, 126, 234, 0.3)';
        tab.style.borderColor = '#667eea';
        
        // Mostrar contenido correspondiente
        document.querySelectorAll('.mcp-tab-content').forEach(content => {
          content.style.display = 'none';
        });
        document.getElementById(`mcp-tab-${tabName}`).style.display = 'block';
      });
    });

    // Generar C√≥digo
    document.getElementById('mcp-generate-code').addEventListener('click', async () => {
      const task = document.getElementById('mcp-code-task').value.trim();
      const role = document.getElementById('mcp-code-role').value;
      const language = document.getElementById('mcp-code-lang').value;
      
      if (!task) {
        showToast('‚ùå Por favor describe la tarea', 'error');
        return;
      }
      
      showToast('üíª Generando c√≥digo...');
      
      try {
        if (window.sandraAPI) {
          const result = await window.sandraAPI.mcpGenerateCode(task, role, language);
          
          if (result.success) {
            document.getElementById('mcp-code-output').style.display = 'block';
            document.getElementById('mcp-code-result').textContent = result.result.code;
            showToast('‚úÖ C√≥digo generado correctamente');
          } else {
            showToast('‚ùå Error: ' + result.error, 'error');
          }
        }
      } catch (error) {
        console.error('Error generando c√≥digo:', error);
        showToast('‚ùå Error al generar c√≥digo', 'error');
      }
    });

    // Deploy
    document.getElementById('mcp-deploy-btn').addEventListener('click', async () => {
      const name = document.getElementById('mcp-deploy-name').value.trim();
      const repo = document.getElementById('mcp-deploy-repo').value.trim();
      const provider = document.getElementById('mcp-deploy-provider').value;
      const environment = document.getElementById('mcp-deploy-env').value;
      
      if (!name || !repo) {
        showToast('‚ùå Completa todos los campos', 'error');
        return;
      }
      
      showToast('üöÄ Iniciando despliegue...');
      
      try {
        if (window.sandraAPI) {
          const result = await window.sandraAPI.mcpDeploy({
            name,
            repoUrl: repo,
            provider,
            environment,
            path: `./temp/${name}`
          });
          
          if (result.success) {
            const output = document.getElementById('mcp-deploy-output');
            output.style.display = 'block';
            output.innerHTML = `
              ‚úÖ Despliegue completado<br>
              üì¶ Proyecto: ${name}<br>
              üåê URL: ${result.result.url || 'Generando...'}<br>
              ‚è±Ô∏è Tiempo: ${new Date().toLocaleTimeString()}
            `;
            showToast('‚úÖ Despliegue exitoso');
          } else {
            showToast('‚ùå Error: ' + result.error, 'error');
          }
        }
      } catch (error) {
        console.error('Error en despliegue:', error);
        showToast('‚ùå Error al desplegar', 'error');
      }
    });

    // Spawn Agent
    document.getElementById('mcp-spawn-agent').addEventListener('click', async () => {
      const role = document.getElementById('mcp-agent-role').value;
      
      showToast('ü§ñ Creando agente...');
      
      try {
        if (window.sandraAPI) {
          const result = await window.sandraAPI.mcpSpawnAgent(role, {});
          
          if (result.success) {
            showToast(`‚úÖ Agente ${role} creado`);
            await updateAgentsList();
          } else {
            showToast('‚ùå Error: ' + result.error, 'error');
          }
        }
      } catch (error) {
        console.error('Error creando agente:', error);
        showToast('‚ùå Error al crear agente', 'error');
      }
    });

    async function updateAgentsList() {
      try {
        if (window.sandraAPI) {
          const result = await window.sandraAPI.mcpGetAgents();
          
          if (result.success && result.agents.length > 0) {
            const listHtml = result.agents.map(agent => `
              <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 6px; margin-bottom: 10px; border-left: 3px solid #10b981;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <div style="font-weight: 600; margin-bottom: 5px;">${agent.role}</div>
                    <div style="font-size: 11px; color: rgba(255,255,255,0.5);">ID: ${agent.id}</div>
                  </div>
                  <div style="padding: 4px 12px; background: rgba(16, 185, 129, 0.2); border-radius: 12px; font-size: 11px; color: #10b981;">
                    ${agent.status}
                  </div>
                </div>
                <div style="margin-top: 8px; font-size: 11px; color: rgba(255,255,255,0.6);">
                  Tareas completadas: ${agent.tasksCompleted || 0}
                </div>
              </div>
            `).join('');
            
            document.getElementById('mcp-agents-list').innerHTML = listHtml;
          } else {
            document.getElementById('mcp-agents-list').innerHTML = `
              <div style="text-align: center; color: rgba(255,255,255,0.4); padding: 40px 0;">
                No hay agentes activos
              </div>
            `;
          }
        }
      } catch (error) {
        console.error('Error actualizando lista de agentes:', error);
      }
    }

    // GitHub Sync
    document.getElementById('mcp-github-sync').addEventListener('click', async () => {
      showToast('üîÑ Sincronizando con GitHub...');
      
      try {
        if (window.sandraAPI) {
          const result = await window.sandraAPI.mcpSyncGitHub();
          
          if (result.success) {
            const status = result.result;
            const statusHtml = `
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 6px;">
                  <div style="font-size: 11px; color: rgba(255,255,255,0.5); margin-bottom: 5px;">√öltimo Commit</div>
                  <div style="font-weight: 600; font-size: 13px;">${status.lastCommit ? status.lastCommit.sha.substring(0, 7) : 'N/A'}</div>
                  <div style="font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 5px;">${status.lastCommit ? status.lastCommit.commit.message.substring(0, 50) : ''}</div>
                </div>
                <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 6px;">
                  <div style="font-size: 11px; color: rgba(255,255,255,0.5); margin-bottom: 5px;">Branch</div>
                  <div style="font-weight: 600; font-size: 13px;">${status.branch || 'main'}</div>
                </div>
                <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 6px;">
                  <div style="font-size: 11px; color: rgba(255,255,255,0.5); margin-bottom: 5px;">‚≠ê Stars</div>
                  <div style="font-weight: 600; font-size: 13px;">${status.stars || 0}</div>
                </div>
                <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 6px;">
                  <div style="font-size: 11px; color: rgba(255,255,255,0.5); margin-bottom: 5px;">üîÄ Forks</div>
                  <div style="font-weight: 600; font-size: 13px;">${status.forks || 0}</div>
                </div>
              </div>
            `;
            
            document.getElementById('mcp-github-status').innerHTML = statusHtml;
            showToast('‚úÖ Sincronizaci√≥n completada');
          } else {
            showToast('‚ùå Error: ' + result.error, 'error');
          }
        }
      } catch (error) {
        console.error('Error sincronizando con GitHub:', error);
        showToast('‚ùå Error al sincronizar', 'error');
      }
    });

    console.log('üõ†Ô∏è MCP Panel - Listo');
  </script>
</body>
</html>
